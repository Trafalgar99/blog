# 安装软件程序


## 包管理基础

各种主流Linux发行版都采 用了某种形式的包管理系统来控制软件和库的安装。

软件包存储在服务器上，可以利用本地Linux系统上的PMS工具通过互联网访问。这些服务 器称为仓库（repository）。可以用PMS工具来搜索新的软件包，或者是更新系统上已安装软件包。

软件包通常会依赖其他的包，为了前者能够正常运行，被依赖的包必须提前安装在系统中。 PMS工具将会检测这些依赖关系，并在安装需要的包之前先安装好所有额外的软件包。 

PMS工具及相关命令在不同的Linux发行版上有很大的不同。Linux中广泛使用的两种主要的 PMS基础工具是dpkg和rpm。 

基于Debian的发行版（如Ubuntu和Linux Mint）使用的是dpkg命令，这些发行版的PMS工具 也是以该命令为基础的。dpkg会直接和Linux系统上的PMS交互，用来安装、管理和删除软件包。

基于Red Hat的发行版（如Fedora、openSUSE及Mandriva）使用的是rpm命令，该命令是其PMS 的底层基础。类似于dpkg命令，rmp命令能够列出已安装包、安装新包和删除已有软件。 

这两个命令是它们各自PMS的核心，并非全部的PMS。许多使用dpkg或rpm命令的 Linux发行版都有各自基于这些命令的特定PMS工具，这些工具能够助你事半功倍。

## 基于Debian的系统

dpkg命令是基于Debian系PMS工具的核心。包含在这个PMS中的其他工具有： 

+ apt-get
+ apt-cache
+ aptitude

到目前为止，最常用的命令行工具是aptitude，这是有原因的。aptitude工具本质上是apt工具 和dpkg的前端。dpkg是软件包管理系统工具，而aptitude则是完整的软件包管理系统。 

命令行下使用aptitude命令有助于避免常见的软件安装问题，如软件依赖关系缺失、系统 环境不稳定及其他一些不必要的麻烦。

### 用aptitude管理软件包

如果使用的Linux发行版中已经安装了aptitude，只需要在shell提示符键入aptitude并按下回 车键就行了。紧接着就会进入aptitude的全屏模式

如果你已经知道了系统上的那些软件包，只想快速显示某个特定包的详细信息，就没必要到 aptitude的交互式界面。可以在命令行下以单个命令的方式使用aptitude。 

无法通过aptitude看到的一个细节是所有跟某个特定软件包相关的所有文件的列表。要得 到这个列表，就必须用dpkg命令。 

```bash
dpkg -L vim-common
```

同样可以进行反向操作，查找某个特定文件属于哪个软件包。 

注意，在使用的时候必须用绝对文件路径。 
```bash
dpkg --search /usr/bin/xxd
```

从输出中可以看出/usr/bin/xxd文件是作为vim-common包的一部分被安装的。 

### 用aptitude安装软件包

首先，要 确定准备安装的软件包名称。怎么才能找到特定的软件包呢？用aptitude命令加search选项。
```bash
aptitude search package_name 
```

search选项的妙处在于你无需在package_name周围加通配符。通配符会隐式添加。下面是 用aptitude来查找wine软件包的例子。 

![](image/2020-06-11-16-40-44.png)

在每个包名字之前都有一个p或i。如果看到一个i，说明这个包现在已经安装到了你 的系统上了。如果看到一个p或v，说明这个包可用，但还没安装。我们在上面的列表中可以看到 系统中尚未安装wine，但是在软件仓库中可以找到这个包。 

在系统上用aptitude从软件仓库中安装软件包非常简单。 

```
aptitude install package_name
```

一旦通过search选项找到了软件包名称，只要将它通过install选项插入aptitude命令。


要检查安装过程是否正常，只要再次使用search选项就可以了。

### 用aptitude更新软件

尽管aptitude可以帮忙解决安装软件时遇到的问题，但解决有依赖关系的多个包的更新会 比较烦琐。要用软件仓库中的新版本妥善地更新系统上所有的软件包，可用safe-upgrade选项。

```bash
aptitude safe-upgrade
```

这个命令不需要使用软件包名称作为参数。因为safe-upgrade选项会将所有已安装 的包更新到软件仓库中的最新版本，更有利于系统稳定。 

还有一些不那么保守的软件升级选项： 

+ aptitude full-upgrade
+ aptitude dist-upgrade

这些选项执行相同的任务，将所有软件包升级到最新版本。它们同safe-upgrade的区别在 于，它们不会检查包与包之间的依赖关系。整个包依赖关系问题非常麻烦。如果不是很确定各种 包的依赖关系，那还是坚持用safe-upgrade选项吧。 

显然，应该定期运行aptitude的safe-upgrade选项来保持系统处于最新状态。这点在 安装了一个全新的发行版之后尤其重要。通常在发行版推出最新的完整发布之后，就会 跟着出现很多新的安全补丁和更新。 

### 用aptitude卸载软件

要想只删除软件包而不删除数据和配置文件，可以使用aptitude的remove选项。要删除软 件包和相关的数据和配置文件，可用purge选项。 

要看软件包是否已删除，可以再用aptitude的search选项。如果在软件包名称的前面看到 一个c，意味着软件已删除，但配置文件尚未从系统中清除；如果前面是个p的话，说明配置文件 也已删除。 

### aptitude仓库

aptitude默认的软件仓库位置是在安装Linux发行版时设置的。具体位置存储在文件 /etc/apt/sources. list中。
 
很多情况下，根本不需要添加或删除软件仓库，所以也没必要接触这个文件。但aptitude 只会从这些仓库中下载文件。另外，在搜索软件进行安装或更新时，aptitude同样只会检查这 些库。如果需要为你的PMS添加一些额外的软件仓库，就在这个文件中设置吧。 

> Linux发行版的开发人员下了大工夫，以保证添加到软件仓库的包版本不会互相冲突。通 常通过库来升级或安装软件包是最安全的。即使在其他地方有更新的版本，也应该等到 该版本出现在你的Linux发行版仓库中的时候再安装。 

当需要给你的source_list文件添加软件仓库时，你可以自己发挥，但一般会带来问题。通常软件仓库网站或各种包开发人员网站上都会有一行文本，你可以直接复制，然后粘贴到sources.list 文件中。最好选择较安全的途径并且只复制/粘贴。 

-----------------------------------------
## 基于Red Hat的系统

和基于Debian的发行版类似，基于Red Hat的系统也有几种不同的可用前端工具。常见的有 以下3种。 

+ yum：在Red Hat和Fedora中使用。 
+ urpm：在Mandriva中使用。 
+ zypper：在openSUSE中使用。 

### 列出已安装包

要找出系统上已安装的包，可在shell提示符下输入如下命令： 
```bash
yum list installed
```

yum擅长找出某个特定软件包的详细信息。它能给出关于包的非常详尽的描述，另外你还可 以通过一条简单的命令查看包是否已安装。 

![](image/2020-06-11-16-56-52.png)

最后，如果需要找出系统上的某个特定文件属于哪个软件包，万能的yum可以做到！只要输 入命令： 

```bash
yum provides file_name
```
![](image/2020-06-11-16-57-55.png)


### 用yum安装软件

用yum安装软件包极其简单。下面这个简单的命令会从仓库中安装软件包、所有它需要的库 以及依赖的其他包： 

```bash
yum install package_name
``` 

也可以手动下载rpm安装文件并用yum安装，这叫作本地安装。基本的命令是： 
```bash
yum localinstall package_name.rpm 
```

yum的优点之一就是它的命令富有逻辑性，而且对用户也友好。 

### 用yum更新软件

要列出所有已安装包的可用更新，输入如下命令： 
```bash
yum list updates
```

如果这个命令没有输出就太好了，因为它说明你没有任何需要更新的！但如果发现某个特定 软件包需要更新，输入如下命令： 
```bash
yum update package_name 
```

如果想对更新列表中的所有包进行更新，只要输入如下命令： 
```bash
yum update
```

### 用yum卸载软件

yum工具还提供了一种简单的方法来卸载系统中不再想要的应用。和aptitude一样，你需要 决定是否保留软件包的数据和配置文件。 

只删除软件包而保留配置文件和数据文件，就用如下命令： 
```bash
yum remove package_name
```

要删除软件和它所有的文件，就用erase选项： 
```bash
yum earse package_name
```

### 处理损坏包的依赖关系

有时在安装多个软件包时，某个包的软件依赖关系可能会被另一个包的安装覆盖掉。这叫作 损坏的包依赖关系（broken dependency）。 

如果系统出现了这个问题，先试试下面的命令： 
```bash
yum clean all
```

然后试着用yum命令的update选项。有时，只要清理了放错位置的文件就可以了。 

如果这还解决不了问题，试试下面的命令： 
```bash
yum deplist package_name
```

这个命令显示了所有包的库依赖关系以及什么软件可以提供这些库依赖关系。一旦知道某个 包需要的库，你就能安装它们了。

如果这样仍未解决问题，还有最后一招： 
```bash
yum update --skip-broken
```

--skip-broken选项允许你忽略依赖关系损坏的那个包，继续去更新其他软件包。这可能 救不了损坏的包，但至少可以更新系统上的其他包。 

### yum软件仓库

类似于aptitude系统，yum也是在安装发行版的时候设置的软件仓库。这些预设的仓库就 能很好地满足你的大部分需求。

> 聪明的系统管理员会坚持使用通过审核的仓库。通过审核的仓库是指该发行版官方网站 上指定的库。如果你添加了未通过审核的库，就失去了稳定性方面的保证，可能陷入损 坏的依赖关系惨剧中。 

要想知道你现在正从哪些仓库中获取软件，输入如下命令： 
```bash
yum repolist
```

如果仓库中没有需要的软件，你可以编辑一下配置文件。yum的仓库定义文件位于 /etc/yum.repos.d。你需要添加正确的URL，并获得必要的加密密钥。

---------------------

## 从源码安装

如果你经常在开源软件环境中工作，就很可能会遇到打包成tarball形式的软件。

1. 下载软件包
2. 解压（如果是压缩包）
3. 进入目录，如果用README.md文件，先阅读
4. 运行配置脚本（./configure）
5. 编译源码（make）
