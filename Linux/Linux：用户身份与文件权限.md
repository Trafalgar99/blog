# 用户身份与文件权限

> 本章内容：
> 
> 用户身份与能力；
> 
> 文件权限与归属；
> 
> 文件的特殊权限；
> 
> 文件的隐藏权限；
> 
> 文件访问控制列表；
> 
> su 命令与 sudo 服务


## 用户身份与能力
管理员 UID 为 0：系统的管理员用户。

系统用户 UID 为 1～999： Linux 系统为了避免因某个服务程序出现漏洞而被黑客提 权至整台服务器，默认服务程序会有独立的系统用户负责运行，进而有效控制被破坏 范围。

普通用户 UID 从 1000 开始：是由管理员创建的用于日常工作的用户。

管理员创建的普通用户的 UID 默认是从 1000 开始的（即使前面有闲置的号码）。 

为了方便管理属于同一组的用户，Linux 系统中还引入了用户组的概念。通过使用用 户组号码（GID，Group IDentification），我们可以把多个用户加入到同一个组中，从而方 便为组中的用户统一规划权限或指定任务

在 Linux 系统中创建每个用户时，将自动创建一个与其同名的基本用户组，而且 这个基本用户组只有该用户一个人。如果该用户以后被归纳入其他用户组，则这个其他用户 组称之为扩展用户组。一个用户只有一个基本用户组，但是可以有多个扩展用户组，从而满 足日常的工作需要

**useradd**
> useradd 命令用于创建新的用户，格式为“useradd [选项] 用户名”

可以使用 useradd 命令创建用户账户。使用该命令创建用户账户时，默认的用户家目录会 被存放在/home 目录中，默认的 Shell 解释器为/bin/bash，而且默认会创建一个与该用户同名 的基本用户组

参数|作用
-|-
-d |指定用户的家目录（默认为/home/username） 
-e |账户的到期时间，格式为 YYYY-MM-DD. 
-u |指定该用户的默认 UID 
-g |指定一个初始的用户基本组（必须已存在） 
-G |指定一个或多个扩展用户组 
-N |不创建与用户同名的基本用户组 
-s |指定该用户的默认 Shell 解释器 


下面我们创建一个普通用户并指定家目录的路径、用户的 UID 以及 Shell 解释器。在下 面的命令中，请注意/sbin/nologin，它是终端解释器中的一员，与 Bash 解释器有着天壤之别。 一旦用户的解释器被设置为 nologin，则代表该用户不能登录到系统中： 
```shell
[root@localhost ~]# useradd -d /home/linux -u 8888 -s /sbin/nologin sttop
[root@localhost ~]# id sttop
uid=8888(sttop) gid=8888(sttop) 组=8888(sttop)
```


**groupadd**
> groupadd 命令用于创建用户组，格式为“groupadd [选项] 群组名”。 

创建用户组的步骤非常简单，例如使 用如下命令创建一个用户组 ronny： 
```shell
# groupadd ronny 
```

**usermod**
> usermod 命令用于修改用户的属性，格式为“usermod [选项] 用户名”。 

用户的信息保存在/etc/passwd 文件中，可以直接用文本编辑器来修改其中的用 户参数项目，也可以用 usermod 命令修改已经创建的用户信息，诸如用户的 UID、基本/扩展 用户组、默认终端等。

参数| 作用
-|-
-c |填写用户账户的备注信息 
-d -m |参数-m 与参数-d 连用，可重新指定用户的家目录并自动把旧的数据转移过去
-e |账户的到期时间，格式为 YYYY-MM-DD 
-g | 变更所属用户组
-G |变更扩展用户组 
-L |锁定用户禁止其登录系统 
-U |解锁用户，允许其登录系统 
-s |变更默认终端 
-u |修改用户的 UID 


**passwd**
> passwd命令用于修改用户密码、过期时间、认证信息等，格式为“passwd [选项] [用户名]” 。 

普通用户只能使用 passwd 命令修改自身的系统密码，而 root 管理员则有权限修改其他 所有人的密码。更酷的是，root 管理员在 Linux 系统中修改自己或他人的密码时不需要验证旧 密码，这一点特别方便。既然 root 管理员可以修改其他用户的密码，就表示完全拥有该用户 的管理权限

参数|作用
-|-
-l| 锁定用户，禁止其登录 
-u| 解除锁定，允许用户登录 
--stdin| 允许通过标准输入修改用户密码，如 echo "NewPassWord" | passwd --stdin Username 
-d| 使该用户可用空密码登录系统 
-e| 强制用户在下次登录时修改密码 
-S| 显示用户的密码是否被锁定，以及密码所采用的加密算法名称 

*如何修改用户自己的密码，以及如何修改其他人的密码（修改他 人密码时，需要具有 root 管理员权限）：*
```shell
# passwd 
Changing password for user root. New password:  Retype new password:  passwd: all authentication tokens updated successfully. 

# passwd linuxprobe
Changing password for user linuxprobe. New password:  Retype new password:  passwd: all authentication tokens updated successfully. 
```

**userdel**
> userdel 命令用于删除用户，格式为“userdel [选项] 用户名”。 

如果我们确认某位用户后续不再会登录到系统中，则可以通过 userdel 命令删除该用户的 所有信息。在执行删除操作时，该用户的家目录默认会保留下来，此时可以使用-r 参数将其删 除。

参数|作用
-|-
-f |强制删除用户 
-r |同时删除用户及用户家目录 

-----------------------

## 文件权限与归属

linux中的文件类型：

+ -：普通文件
+ d：目录文件
+ l：链接文件
+ b：块设备文件
+ c：字符设备文件
+ p：管道文件

在 Linux 系统中，每个文件都有所属的所有者和所有组，并且规定了文件的所有者、 所有组以及其他人对文件所拥有的可读（r）、可写（w）、可执行（x）等权限。对于一般文 件来说，权限比较容易理解：“可读”表示能够读取文件的实际内容；“可写”表示能够编 辑、新增、修改、删除文件的实际内容；“可执行”则表示能够运行一个脚本程序。

*对目录文件来说，“可读”表 示能够读取目录内的文件列表；“可写”表示能够在目录内新增、删除、重命名文件；而“可 执行”则表示能够进入该目录。*

文件的读、写、执行权限可以简写为 rwx，亦可分别用数字 4、2、1 来表示，文件所有 者，所属组及其他用户权限之间无关联


文件权限的数字法表示基于字符表示（rwx）的权限计算而来，其目的是简化权限的表示。 例如，若某个文件的权限为 7 则代表可读、可写、可执行（4+2+1）；若权限为 6 则代表可读、 可写（4+2）。


## 文件的特殊权限
> 在复杂多变的生产环境中，单纯设置文件的 rwx 权限无法满足我们对安全和灵活性的需求，因此便有了 SUID、SGID 与 SBIT 的特殊权限位。这是一种对文件权限进行设置的特殊功能，可以与一般权限同时使用，以弥补一般权限不能实现的功能

